import React, { useEffect } from 'react';
import {
    SafeAreaView,
    StyleSheet,
    ScrollView,
    View,
    Text,
    StatusBar,
    Button
} from 'react-native';

import PushNotificationIOS from "@react-native-community/push-notification-ios";
import { COLOR } from '../GlobalConstants';
var PushNotification = require("react-native-push-notification");

const axios = require('axios');




export default class NotificationsComponent extends React.Component {


    constructor(props) {
        super(props);
        this.state = {
            confirmed: 13250,
            active: 5230,
            recovered: 7410,
            deceased: 610,

            containmentZones: null,
            numberOfContainmentZones: null
        }

    }

    UNSAFE_componentWillMount() {
        axios.post('https://data.geoiq.io/dataapis/v1.0/covid/nearbyzones', {
            "key": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJtYWlsSWRlbnRpdHkiOiJydW5ueTIwMThAZ21haWwuY29tIn0.jqS7VuyEFU-pHaQtx9p3VXBFvs8RmQZEUY5RaEEo2Ww",
            "lng": 73.920726,
            "lat": 18.565135,
            "radius": 5000

        })
            .then(response => {
                this.setState({
                    containmentZones: response.data.containmentZoneNames,
                    numberOfContainmentZones: response.data.numberOfNearbyZones
                })
            })
            .catch(error => {
                console.log(error);
            });

    }

    notify = () => {
        PushNotification.localNotification({
            /* Android Only Properties */
            id: 0, // (optional) Valid unique 32 bit integer specified as string. default: Autogenerated Unique ID
            ticker: "My Notification Ticker", // (optional)
            autoCancel: true, // (optional) default: true
            largeIcon: "ic_launcher", // (optional) default: "ic_launcher"
            smallIcon: "ic_notification", // (optional) default: "ic_notification" with fallback for "ic_launcher"
            bigText: "Confirmed : " + this.state.confirmed + " " + "Active : " + this.state.active + "\n" + "Recovered : " + this.state.active + " " + "Deceased : " + this.state.deceased, // (optional) default: "message" prop
            subText: "Pune", // (optional) default: none
            color: COLOR.TURQ, // (optional) default: system default
            vibrate: false, // (optional) default: true
            vibration: 300, // vibration length in milliseconds, ignored if vibrate=false, default: 1000
            tag: "some_tag", // (optional) add tag to message
            group: "group", // (optional) add group to message
            ongoing: false, // (optional) set whether this is an "ongoing" notification
            priority: "high", // (optional) set notification priority, default: high
            visibility: "private", // (optional) set notification visibility, default: private
            importance: "high", // (optional) set notification importance, default: high
            allowWhileIdle: false, // (optional) set notification to work while on doze, default: false
            ignoreInForeground: false, // (optional) if true, the notification will not be visible when the app is in the foreground (useful for parity with how iOS notifications appear)

            /* iOS only properties */
            alertAction: "view", // (optional) default: view
            category: "", // (optional) default: empty string
            userInfo: {}, // (optional) default: {} (using null throws a JSON value '<null>' error)

            /* iOS and Android properties */
            title: "District Stats update", // (optional)
            message: "Expand to see details.", // (required)
            playSound: false, // (optional) default: true
            soundName: "default", // (optional) Sound to play when the notification is shown. Value of 'default' plays the default sound. It can be set to a custom sound such as 'android.resource://com.xyz/raw/my_sound'. It will look for the 'my_sound' audio file in 'res/raw' directory and play it. default: 'default' (default sound is played)
            number: 10, // (optional) Valid 32 bit integer specified as string. default: none (Cannot be zero)
            repeatType: "day", // (optional) Repeating interval. Check 'Repeating Notifications' section for more info.
            //actions: '["Yes", "No"]', // (Android only) See the doc for notification actions to know more
        });
    }

    getNearbyContainmentZones = () => {
        PushNotification.localNotification({
            /* Android Only Properties */
            id: 0, // (optional) Valid unique 32 bit integer specified as string. default: Autogenerated Unique ID
            ticker: "My Notification Ticker", // (optional)
            autoCancel: true, // (optional) default: true
            largeIcon: "ic_launcher", // (optional) default: "ic_launcher"
            smallIcon: "ic_notification", // (optional) default: "ic_notification" with fallback for "ic_launcher"
            bigText: "Namely " + this.state.containmentZones, // (optional) default: "message" prop
            subText: "Pune", // (optional) default: none
            color: COLOR.TURQ, // (optional) default: system default
            vibrate: false, // (optional) default: true
            vibration: 300, // vibration length in milliseconds, ignored if vibrate=false, default: 1000
            tag: "some_tag", // (optional) add tag to message
            group: "group", // (optional) add group to message
            ongoing: false, // (optional) set whether this is an "ongoing" notification
            priority: "high", // (optional) set notification priority, default: high
            visibility: "private", // (optional) set notification visibility, default: private
            importance: "high", // (optional) set notification importance, default: high
            allowWhileIdle: false, // (optional) set notification to work while on doze, default: false
            ignoreInForeground: false, // (optional) if true, the notification will not be visible when the app is in the foreground (useful for parity with how iOS notifications appear)

            /* iOS only properties */
            alertAction: "view", // (optional) default: view
            category: "", // (optional) default: empty string
            userInfo: {}, // (optional) default: {} (using null throws a JSON value '<null>' error)

            /* iOS and Android properties */
            title: "There are " + this.state.numberOfContainmentZones + " containment zones near you", // (optional)
            message: "Expand to see details.", // (required)
            playSound: false, // (optional) default: true
            soundName: "default", // (optional) Sound to play when the notification is shown. Value of 'default' plays the default sound. It can be set to a custom sound such as 'android.resource://com.xyz/raw/my_sound'. It will look for the 'my_sound' audio file in 'res/raw' directory and play it. default: 'default' (default sound is played)
            number: 10, // (optional) Valid 32 bit integer specified as string. default: none (Cannot be zero)
            repeatType: "day", // (optional) Repeating interval. Check 'Repeating Notifications' section for more info.
            //actions: '["Yes", "No"]', // (Android only) See the doc for notification actions to know more
        });


    }



    render() {
        return (
            <View>
                <Button
                    title="District Stats"
                    onPress={() => this.notify()}
                />
                <Button
                    title="Nearby Containment Zones"
                    onPress={() => this.getNearbyContainmentZones()}
                />
            </View>
        )
    }


} 